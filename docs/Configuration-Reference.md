# Configuration Reference

## Overview

skimatik supports flexible configuration through YAML files, command-line flags, and environment variables. This guide covers all available configuration options and their usage patterns.

## üìÅ Configuration File Structure

### Basic Configuration File (`skimatik.yaml`)

```yaml
# Database connection configuration
database:
  dsn: "postgres://username:password@localhost:5432/database"
  schema: "public"
  connect_timeout: "30s"
  query_timeout: "10s"

# Output configuration
output:
  package_name: "repositories"
  output_dir: "./repositories"
  file_header: |
    // Code generated by skimatik. DO NOT EDIT.
    // Source: database schema introspection

# Code generation configuration
generation:
  default_functions: "all"  # "all", "crud", or array of specific functions
  generate_tests: true
  format_code: true
  include_health_checks: true
  include_retry_methods: true

# Table filtering
tables:
  include_patterns:
    - "users"
    - "posts*"
    - "product_*"
  exclude_patterns:
    - "*_temp"
    - "*_audit"
    - "migrations"
    - "schema_migrations"

# Query-based generation (optional)
queries:
  enabled: true
  query_dir: "./sql/queries"
  include_patterns:
    - "*.sql"
  exclude_patterns:
    - "*_test.sql"
```

## üóÑÔ∏è Database Configuration

### Required Fields

#### `database.dsn`
- **Type**: String
- **Required**: Yes
- **Description**: PostgreSQL connection string
- **Format**: `postgres://[user[:password]@][host][:port][/database][?param1=value1&...]`

```yaml
database:
  dsn: "postgres://myuser:mypass@localhost:5432/mydatabase"
```

#### `database.schema`
- **Type**: String
- **Required**: Yes
- **Default**: `"public"`
- **Description**: PostgreSQL schema to introspect

```yaml
database:
  schema: "public"  # or "app", "core", etc.
```

### Optional Fields

#### `database.connect_timeout`
- **Type**: Duration string
- **Default**: `"30s"`
- **Description**: Maximum time to wait for database connection

```yaml
database:
  connect_timeout: "45s"  # 45 seconds
```

#### `database.query_timeout`
- **Type**: Duration string  
- **Default**: `"10s"`
- **Description**: Maximum time to wait for individual queries

```yaml
database:
  query_timeout: "30s"  # For large schema introspection
```

#### `database.ssl_mode`
- **Type**: String
- **Default**: `"prefer"`
- **Options**: `"disable"`, `"require"`, `"verify-ca"`, `"verify-full"`, `"prefer"`
- **Description**: SSL connection mode

```yaml
database:
  ssl_mode: "require"  # Force SSL connections
```

## üì§ Output Configuration

#### `output.package_name`
- **Type**: String
- **Required**: Yes
- **Description**: Go package name for generated files

```yaml
output:
  package_name: "repositories"  # or "models", "data", etc.
```

#### `output.output_dir`
- **Type**: String
- **Required**: Yes
- **Description**: Directory path for generated files (relative or absolute)

```yaml
output:
  output_dir: "./internal/repositories"  # Relative path
  # output_dir: "/absolute/path/to/output"  # Absolute path
```

#### `output.file_header`
- **Type**: Multi-line string
- **Default**: `"// Code generated by skimatik. DO NOT EDIT."`
- **Description**: Custom header for generated files

```yaml
output:
  file_header: |
    // Code generated by skimatik v1.0.0. DO NOT EDIT.
    // Generated at: {{ .Timestamp }}
    // Source: {{ .DatabaseSchema }}
    //
    // This file contains auto-generated repository code.
    // Regenerate using: skimatik --config=skimatik.yaml
```

## ‚öôÔ∏è Generation Configuration

#### `generation.default_functions`
- **Type**: String or Array
- **Default**: `"all"`
- **Options**: 
  - `"all"` - Generate all CRUD operations
  - `"crud"` - Generate basic CRUD only (no pagination, retry, health)
  - Array of specific functions: `["create", "get", "update", "delete", "list"]`

```yaml
generation:
  default_functions: "all"  # Recommended for most use cases

# Or specific functions:
generation:
  default_functions:
    - "create"
    - "get" 
    - "list"
    - "list_paginated"
```

#### `generation.generate_tests`
- **Type**: Boolean
- **Default**: `true`
- **Description**: Generate test files for repositories

```yaml
generation:
  generate_tests: false  # Skip test generation
```

#### `generation.format_code`
- **Type**: Boolean
- **Default**: `true`
- **Description**: Format generated code using `go/format`

```yaml
generation:
  format_code: true  # Always recommended
```

#### `generation.include_health_checks`
- **Type**: Boolean
- **Default**: `true`
- **Description**: Generate health check methods

```yaml
generation:
  include_health_checks: true  # Recommended for production
```

#### `generation.include_retry_methods`
- **Type**: Boolean
- **Default**: `true`
- **Description**: Generate retry wrapper methods

```yaml
generation:
  include_retry_methods: true  # Recommended for resilience
```

## üóÇÔ∏è Table Filtering

### Include Patterns

#### `tables.include_patterns`
- **Type**: Array of strings
- **Description**: Only generate code for tables matching these patterns
- **Supports**: Glob patterns with `*` wildcard

```yaml
tables:
  include_patterns:
    - "users"           # Exact match
    - "user_*"          # Tables starting with "user_"
    - "*_settings"      # Tables ending with "_settings"
    - "product_*_data"  # Complex patterns
```

### Exclude Patterns

#### `tables.exclude_patterns`
- **Type**: Array of strings
- **Description**: Skip tables matching these patterns (applied after include)
- **Supports**: Glob patterns with `*` wildcard

```yaml
tables:
  exclude_patterns:
    - "*_temp"          # Temporary tables
    - "*_audit"         # Audit tables
    - "*_backup"        # Backup tables
    - "migrations"      # Migration tracking
    - "schema_migrations"
    - "flyway_*"        # Flyway migration tables
```

### Pattern Examples

```yaml
# E-commerce example
tables:
  include_patterns:
    - "users"
    - "products"
    - "orders"
    - "order_*"
    - "product_*"
  exclude_patterns:
    - "*_audit"
    - "*_log"
    - "temp_*"

# Multi-tenant example  
tables:
  include_patterns:
    - "tenant_*"
    - "shared_*"
  exclude_patterns:
    - "*_cache"
    - "*_session"
```

## üîç Query-Based Generation

#### `queries.enabled`
- **Type**: Boolean
- **Default**: `false`
- **Description**: Enable query-based code generation

#### `queries.query_dir`
- **Type**: String
- **Default**: `"./queries"`
- **Description**: Directory containing SQL query files

#### `queries.include_patterns`
- **Type**: Array of strings
- **Default**: `["*.sql"]`
- **Description**: Include SQL files matching these patterns

#### `queries.exclude_patterns`
- **Type**: Array of strings
- **Description**: Exclude SQL files matching these patterns

```yaml
queries:
  enabled: true
  query_dir: "./sql/queries"
  include_patterns:
    - "*.sql"
  exclude_patterns:
    - "*_test.sql"
    - "*_migration.sql"
    - "temp_*.sql"
```

## üåç Environment Variables

All configuration values can be overridden using environment variables with the `SKIMATIK_` prefix:

### Database Configuration
```bash
export SKIMATIK_DATABASE_DSN="postgres://user:pass@host:5432/db"
export SKIMATIK_DATABASE_SCHEMA="public"
export SKIMATIK_DATABASE_CONNECT_TIMEOUT="60s"
export SKIMATIK_DATABASE_QUERY_TIMEOUT="30s"
export SKIMATIK_DATABASE_SSL_MODE="require"
```

### Output Configuration
```bash
export SKIMATIK_OUTPUT_PACKAGE_NAME="models"
export SKIMATIK_OUTPUT_OUTPUT_DIR="./generated"
```

### Generation Configuration
```bash
export SKIMATIK_GENERATION_DEFAULT_FUNCTIONS="crud"
export SKIMATIK_GENERATION_GENERATE_TESTS="false"
export SKIMATIK_GENERATION_FORMAT_CODE="true"
export SKIMATIK_GENERATION_INCLUDE_HEALTH_CHECKS="true"
export SKIMATIK_GENERATION_INCLUDE_RETRY_METHODS="true"
```

### Array Environment Variables
For array values, use comma-separated strings:

```bash
export SKIMATIK_TABLES_INCLUDE_PATTERNS="users,posts,comments"
export SKIMATIK_TABLES_EXCLUDE_PATTERNS="*_temp,*_audit"
```

## üöÄ Command Line Flags

All configuration options can be overridden via command-line flags:

### Primary Usage
```bash
skimatic --config=skimatik.yaml
```

### Common Overrides
```bash
# Override output directory
skimatic --config=skimatik.yaml --output-dir=./generated

# Override package name
skimatic --config=skimatik.yaml --package-name=models

# Override database DSN
skimatic --config=skimatik.yaml --database-dsn="postgres://..."

# Enable verbose logging
skimatic --config=skimatik.yaml --verbose

# Dry run (show what would be generated)
skimatic --config=skimatik.yaml --dry-run
```

### Complete Flag Reference
```bash
# Configuration
--config string                 Configuration file path

# Database
--database-dsn string          Database connection string
--database-schema string       Database schema name
--database-connect-timeout     Connection timeout
--database-query-timeout       Query timeout

# Output  
--output-dir string            Output directory
--package-name string          Package name

# Generation
--default-functions string     Default functions to generate
--generate-tests              Generate test files
--no-format                   Skip code formatting
--no-health-checks            Skip health check methods
--no-retry-methods            Skip retry methods

# Table filtering
--include-tables strings      Include table patterns
--exclude-tables strings      Exclude table patterns

# Utility
--verbose                     Enable verbose logging
--dry-run                     Show what would be generated
--validate-config             Validate configuration only
--list-tables                 List available tables
--version                     Show version information
--help                        Show help
```

## üèóÔ∏è Configuration Examples

### Minimal Configuration
```yaml
database:
  dsn: "postgres://user:pass@localhost:5432/mydb"
  schema: "public"

output:
  package_name: "repositories"
  output_dir: "./repositories"
```

### Production Configuration
```yaml
database:
  dsn: "${DATABASE_URL}"  # From environment
  schema: "app"
  connect_timeout: "30s"
  query_timeout: "15s"
  ssl_mode: "require"

output:
  package_name: "repositories"
  output_dir: "./internal/repositories"
  file_header: |
    // Code generated by skimatik. DO NOT EDIT.
    // Generated: {{ .Timestamp }}
    // Schema: {{ .DatabaseSchema }}

generation:
  default_functions: "all"
  generate_tests: true
  format_code: true
  include_health_checks: true
  include_retry_methods: true

tables:
  include_patterns:
    - "users"
    - "accounts"
    - "transactions"
    - "audit_*"
  exclude_patterns:
    - "*_temp"
    - "*_cache"
    - "migrations"
    - "schema_migrations"

queries:
  enabled: true
  query_dir: "./sql/queries"
  include_patterns:
    - "*.sql"
  exclude_patterns:
    - "*_test.sql"
```

### Multi-Environment Configuration

#### Development (`skimatik-dev.yaml`)
```yaml
database:
  dsn: "postgres://dev:devpass@localhost:5432/myapp_dev"
  schema: "public"

output:
  package_name: "repositories"
  output_dir: "./repositories"

generation:
  default_functions: "all"
  generate_tests: true
```

#### Production (`skimatik-prod.yaml`)
```yaml
database:
  dsn: "${DATABASE_URL}"
  schema: "app"
  ssl_mode: "require"

output:
  package_name: "repositories"  
  output_dir: "./internal/repositories"

generation:
  default_functions: "crud"  # Minimal for production
  generate_tests: false      # Tests not needed in production builds
```

## üîß Configuration Validation

### Validate Configuration
```bash
skimatic --config=skimatik.yaml --validate-config
```

### Common Validation Errors

**Missing required fields:**
```
Error: database.dsn is required
Error: output.package_name is required
```

**Invalid patterns:**
```
Error: invalid include pattern: '[invalid'
Error: exclude pattern cannot be empty
```

**Database connection issues:**
```
Error: failed to connect to database: connection refused
Error: schema 'invalid' does not exist
```

### Test Database Connection
```bash
skimatic --config=skimatik.yaml --validate-connection
```

## üìã Best Practices

### 1. Use Environment Variables for Secrets
```yaml
# Good - use environment variables for sensitive data
database:
  dsn: "${DATABASE_URL}"

# Bad - hardcode secrets
database:
  dsn: "postgres://user:password@host:5432/db"
```

### 2. Use Specific Include Patterns
```yaml
# Good - explicit table inclusion
tables:
  include_patterns:
    - "users"
    - "products"
    - "orders"

# Bad - too broad
tables:
  include_patterns:
    - "*"
```

### 3. Exclude Temporary and System Tables
```yaml
tables:
  exclude_patterns:
    - "*_temp"
    - "*_backup"
    - "*_audit"
    - "migrations"
    - "schema_migrations"
    - "pg_*"        # PostgreSQL system tables
```

### 4. Use Configuration Per Environment
```bash
# Development
skimatic --config=config/dev.yaml

# Staging  
skimatic --config=config/staging.yaml

# Production
skimatic --config=config/prod.yaml
```

### 5. Version Control Considerations
```gitignore
# Include configuration templates
config/skimatik.yaml.template

# Exclude environment-specific configs with secrets
config/local.yaml
config/prod.yaml
```

## Related Documentation

- **[Quick Start Guide](Quick-Start-Guide)** - Installation and basic usage
- **[Examples & Tutorials](Examples-and-Tutorials)** - Hands-on examples with real applications
- **[CLI Reference](CLI-Reference)** - Command-line interface documentation 